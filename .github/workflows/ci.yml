name: Code Quality Check

# When should it run?
on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

# What should happen when it runs
jobs:
    basic-checks:
        runs-on: ubuntu-latest

        steps:
            # Get the code
            - name: Get the code from repository
              uses: actions/checkout@v4

            # Set up Node.js
            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version-file: ".nvmrc"
                  cache: "pnpm"

            # Install pnpm
            - name: Install pnpm package manager
              run: npm install -g pnpm

            # Install project dependencies
            - name: Install project dependencies
              run: pnpm install --frozen-lockfile

            # Check if Typescript code compiles
            - name: Check Typescript compilation
              run: pnpm run type-check

            # Run linter
            - name: Check code style with ESLint
              run: pnpm run lint

            # Check code formatting
            - name: Check code formatting
              run: pnpm run format:check

            # Run tests
            - name: Run tests
              run: pnpm run test:run
